This branch demonstrates a bug with 7.0 where all JavaC compilation defaults to JDK 17, even though all the flags for Bazel runtime are respected.

# Compile and run with Java 11 by default
common --java_language_version=11

common --java_runtime_version=remotejdk_11

common --tool_java_language_version=11

common --tool_java_runtime_version=remotejdk_11


common --host_javabase=@bazel_tools//tools/jdk:remote_jdk11

common --javabase=@bazel_tools//tools/jdk:remote_jdk11

common --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_java11

common --java_toolchain=@bazel_tools//tools/jdk:toolchain_java11



Reproduction steps

1) Download bazel-7.0.0-pre.20230906.2-darwin-arm64
2) Run bazel-7.0.0-pre.20230906.2-darwin-arm64 aquery //module_1:greeter_activity
3) Observe that in the output that the Java code is compiled against JDK 17, not 11


action 'Building module_1/libgreeter_activity.jar (2 source files)'
  Mnemonic: Javac
  Target: //module_1:greeter_activity
  Configuration: darwin_arm64-fastbuild
  Execution platform: @local_config_platform//:host
  ActionKey: 88e058133eab83b1d928a809935366871a1584b28f815040921296cd98829277
  Inputs: [bazel-out/darwin_arm64-fastbuild/bin/module_1/greeter_activity_resources.jar, bazel-out/darwin_arm64-fastbuild/bin/module_2/greeter_activity_2_resources.jar, bazel-out/darwin_arm64-fastbuild/bin/module_2/libgreeter_activity_2-hjar.jar, bazel-out/darwin_arm64-fastbuild/bin/module_2/libgreeter_activity_2-hjar.jdeps, bazel-out/darwin_arm64-opt-exec-ST-e846b08c7501/bin/external/bazel_tools/tools/android/java_base_extras.jar, external/androidsdk/platforms/android-33/android.jar, external/remote_java_tools/java_tools/JavaBuilder_deploy.jar, external/remotejdk17_macos_aarch64/bin/jar, external/remotejdk17_macos_aarch64/bin/jarsigner, external/remotejdk17_macos_aarch64/bin/java, external/remotejdk17_macos_aarch64/bin/javac, external/remotejdk17_macos_aarch64/bin/javadoc, external/remotejdk17_macos_aarch64/bin/javap, external/remotejdk17_macos_aarch64/bin/jcmd, external/remotejdk17_macos_aarch64/bin/jconsole, external/remotejdk17_macos_aarch64/bin/jdb, external/remotejdk17_macos_aarch64/bin/jdeprscan, external/remotejdk17_macos_aarch64/bin/jdeps, external/remotejdk17_macos_aarch64/bin/jfr, external/remotejdk17_macos_aarch64/bin/jhsdb, external/remotejdk17_macos_aarch64/bin/jimage, external/remotejdk17_macos_aarch64/bin/jinfo, external/remotejdk17_macos_aarch64/bin/jlink, external/remotejdk17_macos_aarch64/bin/jmap, external/remotejdk17_macos_aarch64/bin/jmod, external/remotejdk17_macos_aarch64/bin/jpackage, external/remotejdk17_macos_aarch64/bin/jps, external/remotejdk17_macos_aarch64/bin/jrunscript, external/remotejdk17_macos_aarch64/bin/jshell, external/remotejdk17_macos_aarch64/bin/jstack, external/remotejdk17_macos_aarch64/bin/jstat, external/remotejdk17_macos_aarch64/bin/jstatd, external/remotejdk17_macos_aarch64/bin/keytool, external/remotejdk17_macos_aarch64/bin/rmiregistry, external/remotejdk17_macos_aarch64/bin/serialver, external/remotejdk17_macos_aarch64/conf/logging.properties, external/remotejdk17_macos_aarch64/conf/management/jmxremote.access, external/remotejdk17_macos_aarch64/conf/management/jmxremote.password.template, external/remotejdk17_macos_aarch64/conf/management/management.properties, external/remotejdk17_macos_aarch64/conf/net.properties, external/remotejdk17_macos_aarch64/conf/security/java.policy, external/remotejdk17_macos_aarch64/conf/security/java.security, external/remotejdk17_macos_aarch64/conf/security/policy/README.txt, external/remotejdk17_macos_aarch64/conf/security/policy/limited/default_US_export.policy, external/remotejdk17_macos_aarch64/conf/security/policy/limited/default_local.policy, external/remotejdk17_macos_aarch64/conf/security/policy/limited/exempt_local.policy, external/remotejdk17_macos_aarch64/conf/security/policy/unlimited/default_US_export.policy, external/remotejdk17_macos_aarch64/conf/security/policy/unlimited/default_local.policy, external/remotejdk17_macos_aarch64/conf/sound.properties, external/remotejdk17_macos_aarch64/include/classfile_constants.h, external/remotejdk17_macos_aarch64/include/darwin/jawt_md.h, external/remotejdk17_macos_aarch64/include/darwin/jni_md.h, external/remotejdk17_macos_aarch64/include/jawt.h, external/remotejdk17_macos_aarch64/include/jdwpTransport.h, external/remotejdk17_macos_aarch64/include/jni.h, external/remotejdk17_macos_aarch64/include/jvmti.h, external/remotejdk17_macos_aarch64/include/jvmticmlr.h, external/remotejdk17_macos_aarch64/include/sizecalc.h, external/remotejdk17_macos_aarch64/lib/classlist, external/remotejdk17_macos_aarch64/lib/ct.sym, external/remotejdk17_macos_aarch64/lib/fontconfig.bfc, external/remotejdk17_macos_aarch64/lib/fontconfig.properties.src, external/remotejdk17_macos_aarch64/lib/jfr/default.jfc, external/remotejdk17_macos_aarch64/lib/jfr/profile.jfc, external/remotejdk17_macos_aarch64/lib/jrt-fs.jar, external/remotejdk17_macos_aarch64/lib/jspawnhelper, external/remotejdk17_macos_aarch64/lib/jvm.cfg, external/remotejdk17_macos_aarch64/lib/libattach.dylib, external/remotejdk17_macos_aarch64/lib/libawt.dylib, external/remotejdk17_macos_aarch64/lib/libawt_lwawt.dylib, external/remotejdk17_macos_aarch64/lib/libdt_socket.dylib, external/remotejdk17_macos_aarch64/lib/libextnet.dylib, external/remotejdk17_macos_aarch64/lib/libfontmanager.dylib, external/remotejdk17_macos_aarch64/lib/libfreetype.dylib, external/remotejdk17_macos_aarch64/lib/libinstrument.dylib, external/remotejdk17_macos_aarch64/lib/libj2gss.dylib, external/remotejdk17_macos_aarch64/lib/libj2pcsc.dylib, external/remotejdk17_macos_aarch64/lib/libj2pkcs11.dylib, external/remotejdk17_macos_aarch64/lib/libjaas.dylib, external/remotejdk17_macos_aarch64/lib/libjava.dylib, external/remotejdk17_macos_aarch64/lib/libjavajpeg.dylib, external/remotejdk17_macos_aarch64/lib/libjawt.dylib, external/remotejdk17_macos_aarch64/lib/libjdwp.dylib, external/remotejdk17_macos_aarch64/lib/libjimage.dylib, external/remotejdk17_macos_aarch64/lib/libjli.dylib, external/remotejdk17_macos_aarch64/lib/libjsig.dylib, external/remotejdk17_macos_aarch64/lib/libjsound.dylib, external/remotejdk17_macos_aarch64/lib/liblcms.dylib, external/remotejdk17_macos_aarch64/lib/libmanagement.dylib, external/remotejdk17_macos_aarch64/lib/libmanagement_agent.dylib, external/remotejdk17_macos_aarch64/lib/libmanagement_ext.dylib, external/remotejdk17_macos_aarch64/lib/libmlib_image.dylib, external/remotejdk17_macos_aarch64/lib/libnet.dylib, external/remotejdk17_macos_aarch64/lib/libnio.dylib, external/remotejdk17_macos_aarch64/lib/libosx.dylib, external/remotejdk17_macos_aarch64/lib/libosxapp.dylib, external/remotejdk17_macos_aarch64/lib/libosxkrb5.dylib, external/remotejdk17_macos_aarch64/lib/libosxsecurity.dylib, external/remotejdk17_macos_aarch64/lib/libosxui.dylib, external/remotejdk17_macos_aarch64/lib/libprefs.dylib, external/remotejdk17_macos_aarch64/lib/librmi.dylib, external/remotejdk17_macos_aarch64/lib/libsaproc.dylib, external/remotejdk17_macos_aarch64/lib/libsplashscreen.dylib, external/remotejdk17_macos_aarch64/lib/libsyslookup.dylib, external/remotejdk17_macos_aarch64/lib/libverify.dylib, external/remotejdk17_macos_aarch64/lib/libzip.dylib, external/remotejdk17_macos_aarch64/lib/modules, external/remotejdk17_macos_aarch64/lib/psfont.properties.ja, external/remotejdk17_macos_aarch64/lib/psfontj2d.properties, external/remotejdk17_macos_aarch64/lib/security/blocked.certs, external/remotejdk17_macos_aarch64/lib/security/cacerts, external/remotejdk17_macos_aarch64/lib/security/default.policy, external/remotejdk17_macos_aarch64/lib/security/public_suffix_list.dat, external/remotejdk17_macos_aarch64/lib/server/classes.jsa, external/remotejdk17_macos_aarch64/lib/server/classes_nocoops.jsa, external/remotejdk17_macos_aarch64/lib/server/libjsig.dylib, external/remotejdk17_macos_aarch64/lib/server/libjvm.dylib, external/remotejdk17_macos_aarch64/lib/shaders.metallib, external/remotejdk17_macos_aarch64/lib/src.zip, external/remotejdk17_macos_aarch64/lib/tzdb.dat, external/remotejdk17_macos_aarch64/release, module_1/src/main/java/com/example/bazel/Greeter.java, module_1/src/main/java/com/example/bazel/MainActivity.java]
  Outputs: [bazel-out/darwin_arm64-fastbuild/bin/module_1/libgreeter_activity-native-header.jar, bazel-out/darwin_arm64-fastbuild/bin/module_1/libgreeter_activity.jar, bazel-out/darwin_arm64-fastbuild/bin/module_1/libgreeter_activity.jar_manifest_proto, bazel-out/darwin_arm64-fastbuild/bin/module_1/libgreeter_activity.jdeps]
  Environment: [LC_CTYPE=en_US.UTF-8]
  Command Line: (exec external/remotejdk17_macos_aarch64/bin/java \
